{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "---\n",
        "title: \"Best Practices for Code Testing\"\n",
        "subtitle: Why testing is on my mind lately, and how I've learned about testing best practices\n",
        "author: Leslie Emery\n",
        "date: \"2025-07-21\"\n",
        "format: \n",
        "    revealjs:\n",
        "        theme: dracula\n",
        "---\n",
        "\n",
        "\n",
        "<!-- systemfonts::system_fonts() to find the available fonts -->\n",
        "\n",
        "\n",
        "## Motivation: `daapr` {.smaller}\n",
        "\n",
        ":::: {.columns}\n",
        "\n",
        "::: {.column width=\"35%\"}\n",
        "- `daapr` is a suite of 4 related R packages for building reproducible, version controlled, collaborative data products\n",
        "- Creator: Afshin Mashadi-Hossein (now at Umoja)\n",
        "- Developers: Burak, Clara, Mandeep, Leslie\n",
        ":::\n",
        "\n",
        "::: {.column width=\"65%\"}\n",
        "- External dependencies\n",
        "    - Pushing to GitHub repos\n",
        "    - Writing pinned data to s3/JEDI Labkey/local storage\n",
        "    - Reading pinned data from s3/JEDI Labkey/local storage\n",
        "- `daapr` is a shell package that loads the real packages `dpi`, `dpbuild`, and `dpdeploy`\n",
        "- Assumes that you're working within a daapr project\n",
        "    - Config files\n",
        "    - Versioned inputs and outputs deployed\n",
        "    - `.Rproj` file active\n",
        "    - Some assumptions you're working interactively in RStudio\n",
        ":::\n",
        "\n",
        "::::\n",
        "\n",
        "::: {.notes}\n",
        "Thinking about the best way to set up tests for this complicated project with a lot of history has me thinking back on my personal journey with testing my code and everything I've learned about tests so far.\n",
        "Using this as an excuse to fill a meeting topic.\n",
        "- `dpi` reads deployed daaps\n",
        "- `dpbuild` creates a daapr project and output files\n",
        "- `dpdeploy` writes daap inputs and outputs to remote pin board\n",
        ":::\n",
        "\n",
        "\n",
        "## How most code \"testing\" in science starts\n",
        "\n",
        "- A file full of code snippets that you run to make sure code is working as you write it\n",
        "- If you're a little more formal, you can set up a file with many `assert` statements\n",
        "- I'm still using this approach sometimes, because Shiny app testing is hard ðŸ™ˆ\n",
        "    - [MRD Hypercare code example](https://biogit.pri.bms.com/Translational-Data-Science/MRDhypercare/blob/08be088487f6ec827659bf15ece08c0da69b37d7/dev/02_dev.R#L119)\n",
        "\n",
        "## Flashback: \"testing\" code from my dissertation {.smaller}\n",
        "\n",
        "- Running simulations of human population genetics\n",
        "    - Output: 1,000 replicates, each with 300 individuals, 1 Mb sequence\n",
        "    - Code to aggregate summary statistics over these replicates\n",
        "- I saved a set of small test data (20 replicates, fewer individuals, much shorter sequence length) and every time I made a code change, I ran the whole pipeline on this test data\n"
      ],
      "id": "252afa5b"
    },
    {
      "cell_type": "code",
      "metadata": {},
      "source": [
        "# Run a function/method and print some useful output if it fails\n",
        "# Don't use this code!!! It's not a good example\n",
        "def tester(command):\n",
        "\ttry:\n",
        "\t\texec command in globals()\n",
        "\t\tprint \"\\t\", \"-\" * 20\n",
        "\t\tprint \"\\tCommand Successful:\", command\n",
        "\texcept:\n",
        "\t\tprint \"\\tCOMMAND FAILED:\", command\n",
        "\t\tinfo = sys.exc_info()\n",
        "\t\tfor file, lineno, function, text in traceback.extract_tb(info[2]):\n",
        "\t\t\tprint \"\\t\", file, \"line\", lineno, \"in\", function\n",
        "\t\t\tprint \"\\t=>\", repr(text)\n",
        "\t\tprint \"\\t** %s: %s\" % info[:2]"
      ],
      "id": "a68917aa",
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "metadata": {},
      "source": [
        "::: {.notes}\n",
        "This can maybe, charitably, be called an end to end test?\n",
        ":::\n",
        "\n",
        "## Testing for a small scale production Django app\n",
        "\n",
        "[Phenotype Inventory Explorer](https://github.com/UW-GAC/pie)\n",
        "\n",
        "![Tag phenotype variables with controlled vocabulary terms](pie-screenshots/tag-form.png)\n",
        "\n",
        "## Testing for a small scale production Django app\n",
        "\n",
        "[Phenotype Inventory Explorer](https://github.com/UW-GAC/pie)\n",
        "\n",
        "![Tag phenotype variables with controlled vocabulary terms](pie-screenshots/tagged-trait-detail.png)\n",
        "\n",
        "## Testing for a small scale production Django app\n",
        "\n",
        "[Phenotype Inventory Explorer](https://github.com/UW-GAC/pie)\n",
        "\n",
        "![Tag phenotype variables with controlled vocabulary terms](pie-screenshots/tags-summary.png)\n",
        "\n",
        "\n",
        "## Leveling up: using a Python unit testing framework\n",
        "\n",
        "    - Unit tests with test database\n",
        "    - Code coverage\n",
        "    - End to end tests\n",
        "    - Interactive tests with `selenium`\n",
        "\n",
        "\n",
        "## Django best practices from *Two Scoops of Django*\n",
        "\n",
        "![Caption](https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1430285645i/25447991._UY630_SR1200,630_.jpg)\n",
        "\n",
        "- \n",
        "\n",
        "## Test Driven Development with Python\n",
        "\n",
        "![Caption](https://covers.oreillystatic.com/images/0636920051091/lrg.jpg)\n",
        "\n",
        "## *R Packages*\n",
        "\n",
        "![Caption](https://r-pkgs.org/images/cover-2e-small.png)\n",
        "\n",
        "### Chapter 13: Testing basics\n",
        "\n",
        "\n",
        "### Chapter 14: Designing your test suite\n",
        "\n",
        "\n",
        "### Chapter 15: Advanced testing techniques\n",
        "\n",
        "\n",
        "## To mock or not?\n",
        "\n",
        "- Mocking: \n",
        "\n",
        "## Takeaways for `daapr`\n",
        "\n",
        "\n",
        "\n",
        "## Takeaways for your own code (and my other projects)\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "\n",
        "## Columns example\n",
        "\n",
        ":::: {.columns}\n",
        "\n",
        "::: {.column width=\"40%\"}\n",
        "Left column\n",
        ":::\n",
        "\n",
        "::: {.column width=\"60%\"}\n",
        "Right column\n",
        ":::\n",
        "\n",
        "::::"
      ],
      "id": "cb9377e3"
    }
  ],
  "metadata": {
    "kernelspec": {
      "name": "python3",
      "language": "python",
      "display_name": "Python 3 (ipykernel)",
      "path": "/opt/local/Library/Frameworks/Python.framework/Versions/3.10/share/jupyter/kernels/python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 5
}